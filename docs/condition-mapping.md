# 컨디션-메뉴 매핑 설계

## 컨디션 수집 방식

### Phase 1: 버튼 + 세부옵션 (MVP)

#### 1단계: 메인 컨디션 선택
```
┌─────────────────────────────────────┐
│  오늘 컨디션이 어때요?               │
│                                     │
│  [피곤해요] [숙취있어요] [스트레스]   │
│  [감기기운] [든든하게] [가볍게]       │
└─────────────────────────────────────┘
```

#### 2단계: 세부 옵션 선택
```
피곤해요 선택 시:
┌─────────────────────────────────────┐
│  피곤할 땐 어떤 게 끌려요?           │
│                                     │
│  [고기로 충전] [뜨끈한 국물]         │
│  [달달한 보상] [가볍게 회복]         │
└─────────────────────────────────────┘
```

### Phase 2: 채팅 보조 (4주차)
```
버튼으로 해결 안 될 때 → "직접 말해주기" 옵션
→ LLM이 대화로 컨디션 파악
```

### Phase 3: 컨텍스트 자동 추론 (MVP 이후)
```
시간 + 날씨 + 최근 주문 패턴 분석
→ 선제 추천
```

---

## 컨디션 카테고리

### 메인 컨디션 (6개)

| 컨디션 | 아이콘 | 설명 |
|--------|:---:|------|
| 피곤해요 | 😫 | 에너지 충전이 필요한 상태 |
| 숙취있어요 | 🍺 | 해장이 필요한 상태 |
| 스트레스 | 😤 | 스트레스 해소가 필요한 상태 |
| 감기기운 | 🤧 | 몸이 으슬으슬한 상태 |
| 든든하게 | 💪 | 배부르게 먹고 싶은 상태 |
| 가볍게 | 🥗 | 부담 없이 가볍게 먹고 싶은 상태 |

### 세부 옵션

#### 피곤해요
| 옵션 | 추천 방향 |
|------|----------|
| 고기로 충전 | 삼겹살, 갈비, 스테이크 |
| 뜨끈한 국물 | 설렁탕, 곰탕, 순대국 |
| 달달한 보상 | 디저트 카페, 붕어빵 |
| 가볍게 회복 | 죽, 샐러드, 담백한 한식 |

#### 숙취있어요
| 옵션 | 추천 방향 |
|------|----------|
| 뜨끈한 해장 | 해장국, 콩나물국밥, 북어국 |
| 시원한 것 | 냉면, 물회, 동치미국수 |
| 속 편한 것 | 죽, 우동, 칼국수 |
| 얼큰한 것 | 짬뽕, 육개장, 김치찌개 |

#### 스트레스
| 옵션 | 추천 방향 |
|------|----------|
| 매운 걸로 | 엽떡, 불닭, 마라탕 |
| 달달한 걸로 | 케이크, 아이스크림, 와플 |
| 고기가 땡겨 | 삼겹살, 치킨, 곱창 |
| 바삭한 걸로 | 튀김, 탕수육, 돈까스 |

#### 감기기운
| 옵션 | 추천 방향 |
|------|----------|
| 따뜻한 국물 | 삼계탕, 갈비탕, 된장찌개 |
| 부드러운 것 | 죽, 수프, 우동 |
| 비타민 충전 | 과일, 스무디, 샐러드 |
| 몸보신 | 추어탕, 보양식 |

#### 든든하게
| 옵션 | 추천 방향 |
|------|----------|
| 고기 | 삼겹살, 갈비, 불고기 |
| 밥 + 국 | 국밥, 백반, 비빔밥 |
| 면 | 짜장면, 짬뽕, 칼국수 |
| 분식 | 떡볶이, 김밥, 라면 |

#### 가볍게
| 옵션 | 추천 방향 |
|------|----------|
| 샐러드 | 샐러드, 포케, 월남쌈 |
| 담백한 한식 | 두부, 나물, 비빔밥 |
| 간단히 | 김밥, 샌드위치, 토스트 |
| 국물 있게 | 된장국, 미역국, 수프 |

---

## 리뷰 키워드 매핑

### 추출 대상 키워드

| 카테고리 | 키워드 예시 |
|----------|------------|
| 맛 | 맵다, 달다, 짜다, 담백, 고소, 시원, 얼큰 |
| 양 | 푸짐, 양많은, 가성비, 든든, 배부른 |
| 식감 | 부드러운, 바삭, 쫄깃, 촉촉 |
| 상태 | 뜨끈, 따뜻, 시원, 차가운 |
| 효과 | 해장, 힘나는, 회복, 보양, 든든 |
| 분위기 | 조용, 시끄러운, 혼밥, 데이트 |

### 컨디션-키워드 매핑 테이블

```sql
CREATE TABLE condition_keyword_mapping (
    id SERIAL PRIMARY KEY,
    condition VARCHAR(50) NOT NULL,      -- 메인 컨디션
    sub_option VARCHAR(50),              -- 세부 옵션
    keyword VARCHAR(50) NOT NULL,        -- 매칭 키워드
    weight DECIMAL(3,2) DEFAULT 1.0,     -- 가중치
    UNIQUE(condition, sub_option, keyword)
);
```

### 매핑 데이터 예시

| condition | sub_option | keyword | weight |
|-----------|------------|---------|--------|
| 피곤해요 | 고기로 충전 | 푸짐 | 1.0 |
| 피곤해요 | 고기로 충전 | 든든 | 1.0 |
| 피곤해요 | 뜨끈한 국물 | 뜨끈 | 1.2 |
| 피곤해요 | 뜨끈한 국물 | 진한 | 1.0 |
| 숙취있어요 | 뜨끈한 해장 | 해장 | 1.5 |
| 숙취있어요 | 뜨끈한 해장 | 속풀이 | 1.3 |
| 스트레스 | 매운 걸로 | 맵다 | 1.0 |
| 스트레스 | 매운 걸로 | 화끈 | 1.0 |
| 스트레스 | 매운 걸로 | 스트레스해소 | 1.5 |

---

## 추천 알고리즘

### 기본 로직

```python
def recommend(condition, sub_option, location, limit=10):
    # 1. 컨디션에 매핑된 키워드 조회
    keywords = get_keywords(condition, sub_option)

    # 2. 키워드 기반 가게 검색
    restaurants = search_by_keywords(keywords, location)

    # 3. 점수 계산
    for r in restaurants:
        r.score = calculate_score(r, keywords)

    # 4. 정렬 및 반환
    return sorted(restaurants, key=lambda x: x.score, reverse=True)[:limit]

def calculate_score(restaurant, keywords):
    score = 0
    for keyword, weight in keywords:
        # 해당 가게 리뷰에서 키워드 언급 횟수
        count = restaurant.keyword_counts.get(keyword, 0)
        score += count * weight

    # 기본 평점 반영
    score += restaurant.rating * 10

    return score
```

### 추천 결과 형식

```json
{
  "condition": "피곤해요",
  "sub_option": "뜨끈한 국물",
  "recommendations": [
    {
      "id": 123,
      "name": "00설렁탕",
      "category": "한식>설렁탕",
      "rating": 4.5,
      "distance": "350m",
      "match_reason": "리뷰에서 '든든', '뜨끈한 국물' 키워드가 많이 언급되었어요",
      "matched_keywords": ["든든", "뜨끈", "진한 국물"],
      "representative_review": "피곤할 때 먹으면 힘이 나요. 국물이 진하고 든든합니다."
    }
  ]
}
```

---

## 사용자 로그 스키마

### 로그 테이블

```sql
CREATE TABLE user_logs (
    id SERIAL PRIMARY KEY,
    session_id VARCHAR(100),
    user_id VARCHAR(100),              -- 로그인 시
    condition VARCHAR(50) NOT NULL,
    sub_option VARCHAR(50),
    location_lat DECIMAL(10, 8),
    location_lng DECIMAL(11, 8),
    recommended_ids INTEGER[],          -- 추천된 가게 ID 목록
    selected_id INTEGER,                -- 선택한 가게 ID
    rating INTEGER,                     -- 만족도 (1-5)
    context JSONB,                      -- 추가 컨텍스트
    created_at TIMESTAMP DEFAULT NOW()
);
```

### 컨텍스트 데이터

```json
{
  "time": "19:30",
  "day_of_week": "금요일",
  "weather": "맑음",
  "temperature": 5,
  "device": "mobile"
}
```

### 활용 방안

1. **매핑 정확도 개선**: 선택/만족도 데이터로 키워드 가중치 조정
2. **개인화**: 반복 사용자의 선호 패턴 학습
3. **컨텍스트 추론**: 시간/날씨별 컨디션 예측

---

## UI 목업

### 모바일 화면 흐름

```
[메인 화면]
┌─────────────────────────┐
│  🍽️ 오늘 뭐 먹지?        │
│                         │
│  컨디션을 알려주세요     │
│                         │
│  [😫 피곤] [🍺 숙취]     │
│  [😤 스트레스] [🤧 감기] │
│  [💪 든든히] [🥗 가볍게] │
│                         │
│  [💬 직접 말해주기]      │
└─────────────────────────┘
         │
         ▼
[세부 옵션 화면]
┌─────────────────────────┐
│  😫 피곤할 땐?           │
│                         │
│  [🍖 고기로 충전]        │
│  [🍜 뜨끈한 국물]        │
│  [🍰 달달한 보상]        │
│  [🥗 가볍게 회복]        │
│                         │
│  ← 뒤로                  │
└─────────────────────────┘
         │
         ▼
[추천 결과 화면]
┌─────────────────────────┐
│  🍜 뜨끈한 국물 추천      │
│                         │
│  ┌───────────────────┐  │
│  │ 00설렁탕    ⭐4.5  │  │
│  │ 350m · 한식       │  │
│  │ "국물이 진하고     │  │
│  │  든든해요"        │  │
│  └───────────────────┘  │
│                         │
│  ┌───────────────────┐  │
│  │ 00국밥     ⭐4.3  │  │
│  │ 500m · 한식       │  │
│  └───────────────────┘  │
│                         │
│  [다시 선택하기]         │
└─────────────────────────┘
```
