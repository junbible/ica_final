# [PRD] 컨디션 기반 메뉴 추천 챗봇 서비스 (MVP)

| 문서 버전 | v1.0 | 작성일 | 2026.01.28 |
| :--- | :--- | :--- | :--- |
| **작성자** | 파이널 2팀 | **상태** | Draft |

---

## 1. 비즈니스 목표 및 KPI (핵심 성과 지표)

### 1.1 비즈니스 목표
1.  **메뉴 결정 시간 단축**: "오늘 뭐 먹지?"라는 고민의 시간을 대화형 인터페이스를 통해 획기적으로 줄여줌.
2.  **개인화된 경험 제공**: 단순 리스트 나열이 아닌, 사용자의 컨디션을 물어보고 챙겨주는 듯한 '케어(Care)' 경험 제공.
3.  **챗봇 인터랙션 검증**: 향후 LLM 도입 전, 룰 베이스(Rule-based) 챗봇 형태의 UX가 음식 추천 도메인에서 유효한지 MVP 단계에서 검증.

### 1.2 핵심 성과 지표 (KPI)

| 지표 (Metrics) | 정의 | 목표치 (MVP 기준) |
| :--- | :--- | :--- |
| **챗봇 실행률** | 메인 페이지 방문자 중 챗봇 버튼(FAB)을 클릭한 비율 | 30% 이상 |
| **추천 완주율** | 챗봇 실행 후 최종 메뉴 추천 카드까지 도달한 비율 | 70% 이상 |
| **CTR (전환율)** | 추천된 가게 리스트 중 하나를 클릭(상세보기/지도이동)한 비율 | 15% 이상 |
| **평균 세션 시간** | 챗봇 실행부터 최종 결정까지 걸리는 시간 | 60초 이내 (빠른 결정 유도) |

---

## 2. 주요 기능 목록 (Feature List)

### 2.1 프론트엔드 (Client)

#### A. 메인 랜딩 페이지 (Main Page)
* **서비스 소개**: "당신의 오늘 컨디션에 딱 맞는 한 끼를 찾아드려요" 등의 카피와 감성적인 배경 이미지/영상 노출.
* **챗봇 트리거 (Floating Action Button)**: 화면 우측 하단 고정. "오늘 뭐 먹지? 물어보기" 툴팁 제공. 스크롤 시에도 항상 노출.

#### B. 챗봇 인터페이스 (Chatbot UI)
* **오버레이/모달 형태**: FAB 클릭 시 전체 화면 또는 팝업 형태로 채팅창 활성화.
* **메시지 버블**: 시스템(봇) 메시지와 사용자 선택 메시지 구분 (Left/Right alignment).
* **선택 옵션 (Quick Reply)**: 텍스트 입력 대신 하단에 버튼(Chips) 형태로 선택지 제공.
    * 1단계: 컨디션 (피곤/숙취/스트레스/감기/든든/가볍게)
    * 2단계: 세부 취향 (국물/고기/면 등)
* **추천 결과 카드 (Carousel)**: 채팅창 내에서 좌우 스와이프 가능한 카드 형태로 추천 가게 노출.
    * 구성: 가게명, 사진, 평점, 거리, **추천 사유(키워드)**, 지도 보기 버튼.

### 2.2 백엔드 (Server) & 데이터

#### C. 추천 엔진 (Recommendation Engine)
* **매핑 로직 처리**: 사용자가 선택한 `Condition` + `Sub-option`을 쿼리로 변환.
* **스코어링(Scoring)**: 사용자 위치 기반 필터링 후, **리뷰 키워드 단순 횟수 합산 + 평점 가중치** 방식으로 점수 산출.
* **정렬**: 점수순 상위 5~10개 매장 추출 및 응답 JSON 생성.

#### D. 데이터 수집 및 관리
* **크롤러 (Crawler)**: 네이버 플레이스 리뷰 주기적 수집 (배치 작업).
* **NLP 모듈**: 리뷰 텍스트에서 형태소 분석 후 사전에 정의된 '맛/상태/기분' 키워드 추출 및 태깅.

---

## 3. 유저 시나리오 3가지 (User Stories)

### 시나리오 1: 격무에 시달린 "김대리" (피곤함 → 고기)
1.  **진입**: 퇴근길 지하철, 저녁 메뉴를 고민하며 앱에 접속. 메인에서 감성적인 문구를 보고 우측 하단 **[챗봇 아이콘]** 터치.
2.  **대화 시작**: 챗봇이 *"오늘 하루 어떠셨나요?"*라고 물으며 옵션 버튼을 띄움.
3.  **옵션 선택**: **[😫 피곤해요]** 버튼 터치.
4.  **세부 선택**: 챗봇이 *"고생하셨네요. 기운 나게 도와드릴까요?"*라며 2차 옵션 제시. 김대리는 **[🍖 고기로 충전]** 선택.
5.  **결과 확인**: 채팅창에 *"육즙 가득한 삼겹살 맛집들을 찾아왔어요"*라는 멘트와 함께 회사 근처 평점 4.5 이상 고기집 5곳이 카드 형태로 뜸.
6.  **행동**: '00삼겹살' 카드를 눌러 리뷰를 확인하고 친구에게 링크 공유.

### 시나리오 2: 회식 다음 날 "이사원" (숙취 → 해장)
1.  **진입**: 점심시간 10분 전, 속이 안 좋은 상태로 웹사이트 접속. 바로 **[SOS 해장 추천]** (챗봇 버튼 툴팁) 클릭.
2.  **옵션 선택**: 챗봇의 질문에 **[🍺 숙취있어요]** 선택.
3.  **세부 선택**: 챗봇이 *"해장이 시급하시군요. 어떤 스타일로?"* 질문. 이사원은 **[🍜 뜨끈한 국물]** 선택.
4.  **결과 확인**: *"속 풀리는 국물 맛집이에요"*라며 근처 순대국, 콩나물국밥집 리스트업. 리뷰 키워드에 **#속풀이 #얼큰한**이 강조된 것을 보고 바로 출발.

### 시나리오 3: 다이어트 중인 "박팀장" (가볍게 → 샐러드)
1.  **진입**: 간단하게 먹고 싶어 접속. 챗봇을 열고 **[🥗 가볍게]** 선택.
2.  **세부 선택**: 챗봇이 *"부담 없는 한 끼를 원하시나요?"*라고 묻자 **[샌드위치/샐러드]** 옵션 선택.
3.  **결과 확인**: 근처 포케집과 샐러드 전문점이 추천됨.
4.  **재검색**: 마음에 드는 곳이 없자 채팅창 내 **[다른 추천 보기]** 버튼을 눌러 목록을 갱신하거나, **[처음으로]**를 눌러 다시 시작.

---

## 4. 출시 및 성공 기준 정의 (Launch & Success Criteria)

### 4.1 출시 기준 (QA Pass Criteria)
* **기능 동작**: 챗봇 내 버튼 클릭 시 딜레이 없이(1초 이내) 다음 대화/옵션이 출력되어야 함.
* **데이터 정확도**: 서울 강남/홍대 지역(MVP 타겟) 내에서 좌표 기반 검색 시, 실제 영업 중인 가게가 90% 이상 노출되어야 함 (폐업 가게 노출 지양).
* **반응형 UI**: 모바일 웹(Mobile Web) 환경에서 챗봇 오버레이가 키보드나 하단 바에 가려지지 않아야 함.
* **예외 처리**: 추천 결과가 0건일 경우, "근처에 딱 맞는 곳이 없네요. 범위를 넓혀볼까요?" 등의 대체 메시지 및 재시도 로직 정상 작동.

### 4.2 성공 기준 (Success Criteria)
* **정량적 기준**:
    * 오픈 후 1개월 내 **MAU(월 활성 사용자) 1,000명** 달성.
    * **재방문율 20%** 이상 (한 번 써본 사람이 편해서 다시 옴).
* **정성적 기준**:
    * "결정 장애가 해결됐다", "내 기분을 알아주는 것 같다"는 긍정적 리뷰 확보.
    * 챗봇 대화 흐름이 끊기지 않고 자연스럽다는 사용자 피드백.

---

## 5. 유저 경험 설계 (UX & UI) - How

### 5.1 유저 플로우 (User Flow)
사용자의 진입부터 메뉴 선택까지의 여정을 끊김 없는 대화형 구조로 설계합니다.

> **Main Page** → **FAB Click** → **Chatbot Open** → **Condition Select** → **Detail Option Select** → **Recommendation (Loading)** → **Result Cards** → **Detail View**

1.  **Landing**: 메인 페이지 진입 (서비스 가치 제안)
2.  **Trigger**: 우측 하단 FAB(Floating Action Button) 클릭
3.  **Chat Initiate**: 챗봇 모달 오픈 → 봇의 첫 인사 (Loading 0.5s → 텍스트 출력)
4.  **Interaction 1 (Condition)**: 메인 컨디션 선택 (칩 버튼 클릭)
5.  **Interaction 2 (Detail)**: 세부 옵션 선택 (칩 버튼 클릭)
6.  **Processing**: 추천 엔진 계산 (Lottie 로딩 애니메이션 노출, 1~2초)
7.  **Result**: 카드 캐러셀(Carousel) 형태로 결과 노출
8.  **Action**: 가게 카드 클릭 (상세 정보) or '다시하기' 클릭

### 5.2 주요 UI 화면 및 인터랙션 정의

| 화면/컴포넌트 | UI 구성 요소 | 인터랙션/애니메이션 |
| :--- | :--- | :--- |
| **메인 홈** | - 감성적인 배경 이미지/영상<br>- 서비스 한 줄 소개 (H1)<br>- **FAB (고정 버튼)**: 💬 아이콘 + "점심 추천받기" 툴팁 | - FAB: 스크롤 시에도 항상 최상위 레이어(Z-index)에 고정<br>- 툴팁: 3초 후 페이드 아웃 |
| **챗봇 (대화창)** | - 헤더: 닫기(X) 버튼, 봇 프로필<br>- 바디: 말풍선 리스트 (스크롤 영역)<br>- 풋터: **선택지 영역 (Chips)** | - 메시지 수신 시: "..." 타이핑 인디케이터 0.5초 노출 후 말풍선 등장 (Slide Up)<br>- 선택지 클릭 시: 사용자의 말풍선으로 변환되어 대화창에 등록됨 |
| **로딩 화면** | - 챗봇 말풍선 내 로딩 애니메이션 | - 문구 랜덤 노출 ("맛집 스캔 중...", "리뷰 분석 중...") |
| **결과 카드** | - 가로 스크롤 가능한 카드 리스트<br>- 가게명, 별점, 거리, **매칭 태그(#)**<br>- 지도 보기 버튼 | - 카드 스와이프 시 부드러운 스냅(Snap) 효과<br>- 태그: 강조색(Primary Color) 적용 |

---

## 6. 상세 기능 명세 (Functional Requirements) - What

### 6.1 프론트엔드 기능 명세 (Client)

#### [FE-01] 챗봇 대화 엔진 (Rule-based)
* **Trigger**: FAB 클릭 시 `ChatModal` 컴포넌트 마운트.
* **시나리오 관리**: JSON 형태의 시나리오 파일을 기반으로 동작.
* **입력 제한**: MVP 단계에서는 자유 텍스트 입력(`input text`)을 막고, 정해진 **버튼(Chips) 선택만 가능**하게 처리.

#### [FE-02] 위치 정보 수집
* **시점**: 챗봇 진입 후 첫 옵션 선택 시 브라우저 Geolocation API 호출.
* **권한 거부 시**: Default 좌표(강남역) 설정 및 Toast 메시지 노출.

#### [FE-03] 결과 카드 렌더링
* **데이터 바인딩**: API 응답(`List<Restaurant>`)을 받아 카드 렌더링.
* **추천 사유 하이라이트**: API에서 전달받은 `matched_keywords`를 카드 상단에 뱃지로 노출.

### 6.2 백엔드 기능 명세 (Server)

#### [BE-01] 추천 알고리즘 (Scoring Logic)
* **API**: `POST /api/v1/recommend`
* **Input**:
    * `condition`: 메인 컨디션 코드 (예: `hangover`)
    * `detail`: 세부 옵션 코드 (예: `soup`)
    * `lat`, `lng`: 사용자 좌표
* **Logic (단순 횟수 합산 방식)**:
    1.  **후보군 필터링**: 사용자 좌표 기준 반경 1.5km 이내 영업 중인(`status='OPEN'`) 식당 조회.
    2.  **점수 계산 공식**:
        $$TotalScore = \sum (KeywordCount \times Weight) + (Rating \times 10)$$
        * **KeywordCount**: `restaurant_keywords` 테이블에서 해당 가게의 타겟 키워드 언급 횟수 (없으면 0).
        * **Weight**: `condition_rules` 테이블에 정의된 키워드별 가중치.
        * **Rating**: 네이버 플레이스 평점 (0.0 ~ 5.0).
    3.  **계산 시뮬레이션 예시 (숙취 → 국물)**:
        * **매핑 규칙**: `해장`(2.0배), `얼큰`(1.5배)
        * **가게 A 데이터**: 평점 4.2 / 리뷰에서 '해장' 20회, '얼큰' 10회 언급.
        * $$Score_A = (20 \times 2.0) + (10 \times 1.5) + (4.2 \times 10) = 40 + 15 + 42 = \mathbf{97점}$$
    4.  **정렬 및 반환**: 최종 점수 내림차순 정렬 후 상위 10개 반환.

#### [BE-02] 리뷰 분석 배치 (Batch)
* **주기**: 매일 새벽 3시 실행.
* **Process**: 신규 리뷰 텍스트 로드 → 형태소 분석(KoNLPy) → 불용어 제거 및 유효 키워드 카운팅 → DB 업데이트.

---

## 7. 데이터 및 로그 설계 (Data & Analytics)

### 7.1 활용 API 및 도구
* **Naver Place Search API**:
    * 목적: 가게 기본 정보(이름, 카테고리, 좌표) 확보
    * 제한: 일 25,000회
* **Playwright (Python)**:
    * 목적: 네이버 지도 리뷰 탭 크롤링 (텍스트, 방문자 리뷰)
    * 주의: `robots.txt` 준수 및 요청 딜레이 설정
* **Kakao Map API (보조)**:
    * 목적: 좌표계 변환(KATECH → WGS84) 및 주소 검증

### 7.2 데이터베이스 스키마 (ERD)

**1) 가게 정보 (restaurants)**
```sql
CREATE TABLE restaurants (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    category VARCHAR(50),
    geo_point GEOGRAPHY(Point, 4326),  -- PostGIS 활용 (거리 계산용)
    naver_map_url VARCHAR(255),
    rating DECIMAL(2,1),               -- 0.0 ~ 5.0
    status VARCHAR(20) DEFAULT 'OPEN'  -- 영업상태
);

```

**2) 가게별 키워드 통계 (restaurant_keywords)**

```sql
CREATE TABLE restaurant_keywords (
    restaurant_id INTEGER REFERENCES restaurants(id),
    keyword VARCHAR(50),               -- 예: '든든한', '매운'
    count INTEGER DEFAULT 0,           -- 언급 횟수
    PRIMARY KEY (restaurant_id, keyword)
);

```

**3) 컨디션-키워드 매핑 (condition_rules)**

```sql
CREATE TABLE condition_rules (
    condition_code VARCHAR(20),        -- 'TIRED'
    detail_code VARCHAR(20),           -- 'MEAT'
    target_keyword VARCHAR(50),        -- '구워주는'
    weight DECIMAL(3,2)                -- 1.2
);

```

### 7.3 사용자 로그 설계 (User Events)

서비스 개선과 추천 품질 향상을 위해 수집해야 할 로그입니다.

| Event Name | Parameter | Description | 활용 목적 |
| --- | --- | --- | --- |
| `chat_start` | `user_id`, `timestamp` | 챗봇 실행 시점 | 챗봇 실행률(KPI) 측정 |
| `select_condition` | `condition_type` | 1단계 컨디션 선택 값 | 가장 많이 선택되는 컨디션 파악 |
| `select_detail` | `detail_option` | 2단계 세부 옵션 값 | 유저의 구체적 니즈 파악 |
| `rec_complete` | `latency_ms`, `result_count` | 추천 결과 로딩 완료 | 시스템 성능 모니터링 |
| **`click_restaurant`** | `restaurant_id`, `rank` | 결과 카드 클릭 | **추천 정확도 평가 (상위 랭크 클릭률)** |
| `click_retry` | `current_step` | 다시하기/이전으로 클릭 | 추천 결과 불만족 비율 측정 |



